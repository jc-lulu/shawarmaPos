<?php
include('cedric_dbConnection.php'); // Make sure the connection file is properly included

// Handle form submission
if ($_SERVER["REQUEST_METHOD"] == "POST") {
    $username = $_POST['username'];
    $email = $_POST['email'];
    $password = $_POST['password'];

    if (!empty($username) && !empty($email) && !empty($password)) {
        // Check if the email exists
        $sqlemail = "SELECT username, email FROM userstable WHERE email = '$email'";
        $emailresult = $connection->query($sqlemail);

        if ($emailresult->num_rows > 0) {
            $row = $emailresult->fetch_assoc();
            if ($username == $row['username']) {
                $modalTitle = 'Error';
                $modalMessage = 'Username already exists!';
                $modalColor = '#BD5B5B'; // Red color
            } else if ($email == $row['email']) {
                $modalTitle = 'Error';
                $modalMessage = 'Email already exists!';
                $modalColor = '#BD5B5B'; // Red color
            }
        } else {
            // Hash the password
            $password = password_hash($password, PASSWORD_DEFAULT);

            // Insert new user into the database
            $sql = "INSERT INTO userstable (username, email, password) VALUES ('$username', '$email', '$password')";
            $result = $connection->query($sql);

            if ($result) {
                $modalTitle = 'Success';
                $modalMessage = 'Account created successfully!';
                $modalColor = '#4CAF50'; // Green color
                $redirect = true; // Set redirect flag
            } else {
                $modalTitle = 'Error';
                $modalMessage = 'Error creating account';
                $modalColor = '#BD5B5B'; // Red color
            }
        }
    } else {
        $modalTitle = 'Warning';
        $modalMessage = 'All fields are required!';
        $modalColor = '#FFA500'; // Orange color
    }
}
